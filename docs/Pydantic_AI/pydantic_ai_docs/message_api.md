# Pydantic AI Messages API (`pydantic_ai.messages`)

## Message Structure Overview

The `ModelMessage` object is the top-level union used to represent messages exchanged with an AI model. It can take the form of either a `ModelRequest` or a `ModelResponse`, depending on the message direction.

---

### ðŸ” `ModelMessage` (Union)
Represents any message sent to or received from a model. It is a union of:
- `ModelRequest`
- `ModelResponse`

---

### ðŸ”¹ `ModelRequest`
```python
ModelRequest(parts: list[ModelRequestPart])
```
A request sent to the model. It consists of a list of `ModelRequestPart` objects.

#### `ModelRequestPart` (Union)
Each part in the request can be one of:
- **`SystemPromptPart`**: Sets the system-level instructions for the model.
- **`UserPromptPart`**: The actual user message/input.
- **`ToolReturnPart`**: Contains the output from a previously used tool.
- **`RetryPromptPart`**: Supplies information from a previous failed attempt (e.g., a retry hint).

---

### ðŸ”¸ `ModelResponse`
```python
ModelResponse(parts: list[ModelResponsePart])
```
A response generated by the model. It consists of a list of `ModelResponsePart` objects.

#### `ModelResponsePart` (Union)
Each part in the response can be one of:
- **`TextPart`**: Regular text output from the model.
- **`ToolCallPart`**: A signal from the model to call a specific tool.
- **`ThinkingPart`**: A thinking response from the model.

---

### ðŸ§  Summary (Plain English)
- All model communication is wrapped in a `ModelMessage`.
- A `ModelRequest` contains instructions, user input, or prior tool info.
- A `ModelResponse` includes either generated text or a tool invocation.
- This structure makes multi-step reasoning and tool use explicit and modular.

---

## Request Message Parts

### `SystemPromptPart` dataclass
A system prompt, generally written by the application developer, giving the model context and guidance.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `content: str`: The content of the prompt.
- `timestamp: datetime`: The timestamp of the prompt.
- `dynamic_ref: str | None`: The ref of the dynamic system prompt function that generated this part.
- `part_kind: Literal['system-prompt']`: Part type identifier.

### `UserPromptPart` dataclass
A user prompt, generally written by the end user.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `content: str | Sequence[UserContent]`: The content of the prompt.
- `timestamp: datetime`: The timestamp of the prompt.
- `part_kind: Literal['user-prompt']`: Part type identifier.

### `ToolReturnPart` dataclass
A tool return message, encoding the result of running a tool.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `tool_name: str`: The name of the tool that was called.
- `content: Any`: The return value.
- `tool_call_id: str`: The tool call identifier, used for matching with the `ToolCallPart`.
- `timestamp: datetime`: The timestamp when the tool returned.
- `part_kind: Literal['tool-return']`: Part type identifier.

**Methods:**
- `model_response_str() -> str`: Returns a string representation of the content for the model.
- `model_response_object() -> dict[str, Any]`: Returns a dictionary representation of the content.

### `RetryPromptPart` dataclass
A message back to a model asking it to try again.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `content: list[ErrorDetails] | str`: Details of why the model should retry.
- `tool_name: str | None`: The name of the tool that was called, if any.
- `tool_call_id: str`: The tool call identifier.
- `timestamp: datetime`: The timestamp when the retry was triggered.
- `part_kind: Literal['retry-prompt']`: Part type identifier.

**Methods:**
- `model_response() -> str`: Returns a string message describing why the retry is requested.

---

## Response Message Parts

### `TextPart` dataclass
A plain text response from a model.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `content: str`: The text content of the response.
- `part_kind: Literal['text']`: Part type identifier.

**Methods:**
- `has_content() -> bool`: Returns `True` if the text content is non-empty.

### `ThinkingPart` dataclass
A thinking response from a model.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `content: str`: The thinking content of the response.
- `id: str | None`: The identifier of the thinking part.
- `signature: str | None`: The signature of the thinking (Anthropic models only).
- `part_kind: Literal['thinking']`: Part type identifier.

**Methods:**
- `has_content() -> bool`: Returns `True` if the thinking content is non-empty.

### `ToolCallPart` dataclass
A tool call from a model.
*Source code in `pydantic_ai_slim/pydantic_ai/messages.py`*

**Attributes:**
- `tool_name: str`: The name of the tool to call.
- `args: str | dict[str, Any] | None`: The arguments to pass to the tool (JSON string or dict).
- `tool_call_id: str`: The tool call identifier.
- `part_kind: Literal['tool-call']`: Part type identifier.

**Methods:**
- `args_as_dict() -> dict[str, Any]`: Returns arguments as a dictionary.
- `args_as_json_str() -> str`: Returns arguments as a JSON string.
- `has_content() -> bool`: Returns `True` if the arguments contain any data.

---

## Streaming Events and Deltas

### Deltas (Partial Updates)

- **`TextPartDelta` dataclass**: A partial update for a `TextPart` to append new text.
- **`ThinkingPartDelta` dataclass**: A partial update for a `ThinkingPart` to append new thinking content.
- **`ToolCallPartDelta` dataclass**: A partial update for a `ToolCallPart` to modify its name or arguments.

### Stream Events (`AgentStreamEvent`)

This is a union of events that can occur during an agent's streaming run.

- **`PartStartEvent` dataclass**: Indicates a new response part has started.
  - `index: int`: The index of the part in the response list.
  - `part: ModelResponsePart`: The new `ModelResponsePart` that has started.

- **`PartDeltaEvent` dataclass**: Indicates a delta update for an existing part.
  - `index: int`: The index of the part to update.
  - `delta: ModelResponsePartDelta`: The delta to apply.

- **`FinalResultEvent` dataclass**: Indicates the response matches the output schema and will produce a final result.
  - `tool_name: str | None`: The name of the output tool that was called.
  - `tool_call_id: str | None`: The associated tool call ID.

- **`FunctionToolCallEvent` dataclass**: Indicates the start of a call to a function tool.
  - `part: ToolCallPart`: The tool call to make.
  - `call_id: str`: An ID for matching the call to its result.

- **`FunctionToolResultEvent` dataclass**: Indicates the result of a function tool call.
  - `result: ToolReturnPart | RetryPromptPart`: The result of the tool call.
  - `tool_call_id: str`: An ID to match the result to its original call.

---

## File and Binary Content

Pydantic AI also supports multimodal inputs.

- **`FileUrl` (ABC)**: Base class for URL-based files (`VideoUrl`, `AudioUrl`, `ImageUrl`, `DocumentUrl`).
- **`BinaryContent` dataclass**: Represents binary content like an image or audio file.
  - `data: bytes`: The binary data.
  - `media_type: str`: The media type of the data.